import { Meta } from '@storybook/addon-docs';

<Meta
	title="Release notes/Source v4"
	parameters={{ previewTabs: { canvas: { hidden: true } } }}
/>

# What's new in v4.0.0

_tl;dr_

-   The package structures have been simplified
-   New ESLint plugins provide an automated migration path (using the ESLint `--fix` flag)
-   Dependencies have not changed

This should make Source easier to consume and contribute to

## Packages

### Before

Previously, the foundations of our visual design language (colours, spacing, typography) were published in `@guardian/src-foundations`. They were accompanied by a set of React components that were published **individually**, following a `@guardian/src-*` naming system.

### After

In v4, `@guardian/src-foundations` is replaced by `@guardian/source-foundations`, and all the React components are published together in a **single new package** called `@guardian/source-react-components`.

### Summary

| Versions | Design Foundations             | Components                                            |
| :------- | :----------------------------- | :---------------------------------------------------- |
| `3.*`    | `@guardian/src-foundations`    | `@guardian/src-accordion`, `@guardian/src-brand` etc… |
| `4.0.0`  | `@guardian/source-foundations` | `@guardian/source-react-components`                   |

### Versioning

`@guardian/source-foundations` and `@guardian/source-react-components` start at `4.0.0` to maintain the current version numbering.

However, unlike before, _their version numbers will not stay in sync going forward_. Instead, packages like `source-react-components` that depend on `source-foundations` should declare the version they need in their `peerDependencies`.

> Components change more frequently than the fundamentals of our design, and it seems odd to bump the foundations package because a component in a different package has changed (especially if you were only using the foundations package in the first place).

## Migrating

### Via codemod

Two new ESLint plugins accompany this release which can migrate your project to v4 automatically, using ESLint’s `--fix` option:

-   `@guardian/eslint-plugin-source-foundations`
-   `@guardian/eslint-plugin-source-react-components`

They contain Source-specific linting rules that are highly recommended for your project.

#### Instructions

-   Uninstall all `@guardian/src-*` packages
-   Install the new packages (as required):
    -   `@guardian/source-foundations`
    -   `@guardian/source-react-components`
-   Install the new ESLint plugins (as required) as `devDependencies`:

    -   `@guardian/eslint-plugin-source-foundations`
    -   `@guardian/eslint-plugin-source-react-components`

-   Add the relevant configs for your project: [@guardian/eslint-plugin-source-foundations](https://github.com/guardian/source/tree/main/packages/%40guardian/eslint-plugin-source-foundations#usage) or [@guardian/eslint-plugin-source-react-components](https://github.com/guardian/source/tree/main/packages/%40guardian/eslint-plugin-source-react-components#usage)
-   Run eslint with the [`--fix` option](https://eslint.org/docs/user-guide/command-line-interface#fixing-problems)

### Manually

It is recommended to follow the steps for [automatic migration](#automagically) however it is also possible to migrate manually. On the whole, migration involves updating import statements for `@guardian/src-*` to either `@guardian/source-foundations` or `@guardian/source-react-components`. Some further changes may be required in specific cases. More information in these can be found in the [What else has changed?](#what-else-has-changed) section.

The recommended manual steps are:

-   Remove any `@guardian/src-*` packages from your `package.json`
-   Add the `@guardian/source-foundations` and/or `@guardian/source-react-components` packages, depending on your use requirements
-   Search for all ocurrences of `@guardian/src-` and fix as required

## Other changes

We minimised other changes to keep migration as simple as possible, but some house-keeping was required.

There is a codemod to automate handling these (see below), but the full list of changes required for each package are available for the curious:

-   [foundations changes](https://github.com/guardian/source/blob/main/packages/%40guardian/source-foundations/migration-breaking-changes.md)
-   [components changes](https://github.com/guardian/source/blob/main/packages/%40guardian/source-react-components/migration-breaking-changes.md)

Note: To conform with the Guardian's [NPM package recommendations](https://github.com/guardian/recommendations/blob/main/npm-packages.md#using-guardian-npm-packages), we [removed an inline polyfill](https://github.com/guardian/source/pull/982/files#diff-1d4bbfb57a73b4844eea8bf903faf617deb06f41c4d06c05e835eb82d2ebaa68L30-L49) for `Object.fromEntries`. If you support [IE11 or another unsupported browser](https://caniuse.com/mdn-javascript_builtins_object_fromentries), you will need to provide a polyfill for this method.
